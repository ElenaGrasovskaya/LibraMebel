"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("fs"),s=require("path"),t=require("./rip.js"),r=require("./compile.js"),i=require("./normalize.js"),n=require("./mkdir.js"),o=require("./pretty.js"),p=require("./constants.js"),u=require("./url.js");exports.bundle=async(c,l,a,{sassOptions:m,cssnanoOptions:d,postcssPlugins:S,inputDirectory:y,purgeCSSOptions:O,publicDirectory:g})=>Promise.all(((c,l,a,{sassOptions:m,cssnanoOptions:d,postcssPlugins:S,inputDirectory:y,purgeCSSOptions:O,publicDirectory:g})=>{const[h,...j]=u.pathStats(a).directories;return t.rip(c,p.STYLESHEET_LINK_REGEXP).map((async t=>{o.start(`Start compiling "${t}" stylesheet.`);const p=u.resolveFile(t,y,s.dirname(l)),a=u.buildOutputUrl(t,g),{css:q}=r.compile(p,m);return i.normalize({html:c,css:q,url:p,cssnanoOptions:d,purgeCSSOptions:O,postcssPlugins:S}).then((async({css:t})=>{const r=s.resolve(h,a);return n.makeDirectories(s.dirname(r)).then((()=>e.promises.writeFile(r,t,{encoding:"utf-8"})))})).then((()=>o.done(`Compiled CSS was written to "${s.join(h,a)}"`))).then((()=>({input:t,output:s.join(...j.map((()=>"..")),a)})),o.oops)}))})(c,l,a,{sassOptions:m,cssnanoOptions:d,postcssPlugins:S,inputDirectory:y,purgeCSSOptions:O,publicDirectory:g})).then((e=>e.filter(Boolean))).then((e=>{const s=e.reduce(((e,{input:s,output:t})=>e.replace(s,t)),c);return e.length>0&&o.done("Public URLs of compiled styles were injected into HTML"),s}),(e=>(o.oops(e),c)));
//# sourceMappingURL=bundle.js.map
