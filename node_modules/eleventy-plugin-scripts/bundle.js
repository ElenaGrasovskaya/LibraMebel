"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("path"),t=require("./rip.js"),r=require("esbuild"),i=require("./path_stats.js"),o=require("./is_production.js"),s=require("./mkdir.js"),n=require("./constants.js"),u=require("./pretty.js");exports.bundle=async(l,p,a)=>Promise.all(((l,p,{inputDirectory:a,esbuildOptions:c,publicDirectory:d})=>{const[j,...b]=i.pathStats(p).directories;return t.rip(l,n.SCRIPTS_LINK_REGEXP).map((async t=>{u.start(`Start compiling "${u.bold(t)}" file.`);const i=e.resolve(a,t),n=e.join(d,t.replace(/ts$/,"js"));return s.makeDirectories(e.dirname(e.resolve(j,n))).then((()=>r.build(Object.assign({bundle:!0,target:"es2017",minify:o.isProduction(),outfile:e.resolve(j,n),sourcemap:!o.isProduction(),entryPoints:[i]},c)))).then((()=>u.done(`Compiled "${u.bold(t)}" script was written to "${u.bold(e.join(j,n))}"`))).then((()=>({input:t,output:e.join(...b.map((()=>"..")),n)})))}))})(l,p,a)).then((e=>e.filter(Boolean))).then((e=>{const t=e.reduce(((e,{input:t,output:r})=>e.replace(t,r)),l);return e.length>0&&u.done(`${e.map((({output:e})=>`"${u.bold(e)}"`)).join(", ")} URL${1===e.length?" was":"s were"} injected into "${u.bold(p)}"`),t}),(e=>(u.oops(e),l)));
//# sourceMappingURL=bundle.js.map
